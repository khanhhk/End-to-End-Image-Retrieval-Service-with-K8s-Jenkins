version: '3.8'

services:
  embedding:
    build:
      context: ../embedding
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    container_name: embedding-container

  ingesting:
    build:
      context: ../ingesting
      dockerfile: Dockerfile
    ports:
      - "5001:5001"
    container_name: ingesting-container
    depends_on:
      - embedding
    env_file:
      - ../ingesting/.env
    environment:
      EMBEDDING_SERVICE_URL: http://embedding:5000/embed
    volumes:
      - /home/khanhhk/MLOPS/MLEK3/project_m1/image-retrieval-project-mlops-f9986ebe9e54.json:/secrets/gcp-key.json:ro
  retriever:
    build:
      context: ../retriever
      dockerfile: Dockerfile
    ports:
      - "5002:5002"
    container_name: retriever-container
    depends_on:
      - embedding
    env_file:
      - ../retriever/.env
    environment:
      EMBEDDING_SERVICE_URL: http://embedding:5000/embed
    volumes:
      - /home/khanhhk/MLOPS/MLEK3/project_m1/image-retrieval-project-mlops-f9986ebe9e54.json:/secrets/gcp-key.json:ro
